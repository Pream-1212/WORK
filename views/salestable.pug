extends table_layout
block content
  .container.mt-5
    h3.mb-3 Sales Records

    // Bootstrap Icons CDN
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css")

    table.table.table-bordered.table-striped.table-sm(style="font-size: 0.9rem;")
      thead.table-dark
        tr
          th Date
          th Customer Name
          th Product Name
          th Product Type
          th Quantity
          th Unit Price
          th Transport
          th Total
          th Agent
          th Payment
          th Delivery
          if currentUser.role === 'manager'
            th.text-center(style="width:60px") Update
            th.text-center(style="width:60px") Delete
      tbody
        if sales && sales.length
          each sale in sales
            tr
              td #{moment(sale.date).format('DD/MM/YYYY')}
              td #{sale.name}
              td #{sale.productName}
              td #{sale.productType}
              td #{sale.quantity}
              td #{sale.unitPrice}
              td #{sale.transportCharge ? sale.transportCharge.toFixed(2) : 0}
              td #{sale.totalPrice ? sale.totalPrice.toFixed(2) : sale.unitPrice * sale.quantity}
              td #{sale.agent ? sale.agent.name : "N/A"}
              td #{sale.payment}
              td #{sale.delivery}
              if currentUser.role === 'manager'
                td.text-center
                  a.btn.btn-sm.btn-outline-warning(href=`/editsales/${sale._id}`, title="Edit")
                    i.bi.bi-pencil-square
                td.text-center
                  form(method='post', action=`/deletesales/${sale._id}`)
                    button.btn.btn-sm.btn-outline-danger(type='submit', title="Delete")
                      i.bi.bi-trash
        else
          tr
            td(colspan="12").text-center No sales available

    if sales && sales.length
      a.btn.btn-success.mt-3(href=`/getReceipt/${sales[0]._id}`) Generate Receipt

    script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js')
